<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FORM: checkpoint.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FORM
   &#160;<span id="projectnumber">5.0.0-beta.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_08d237fc27d4ecd563f71c5d52f2fecc.html">sources</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">checkpoint.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="form3_8h_source.html">form3.h</a>&quot;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
</div>
<p><a href="checkpoint_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a59e324fa8e9090cc97f7098b05b16c23"><td class="memItemLeft" align="right" valign="top"><a id="a59e324fa8e9090cc97f7098b05b16c23"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CACHED_SNAPSHOT</b></td></tr>
<tr class="separator:a59e324fa8e9090cc97f7098b05b16c23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a6befd630ea1c2ab260266f7466540c"><td class="memItemLeft" align="right" valign="top"><a id="a8a6befd630ea1c2ab260266f7466540c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CACHE_SIZE</b>&#160;&#160;&#160;4096</td></tr>
<tr class="separator:a8a6befd630ea1c2ab260266f7466540c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5439c54cd4d43dd7ad07885887811260"><td class="memItemLeft" align="right" valign="top"><a id="a5439c54cd4d43dd7ad07885887811260"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>R_FREE</b>(ARG)&#160;&#160;&#160;	if ( ARG ) M_free(ARG, #ARG);</td></tr>
<tr class="separator:a5439c54cd4d43dd7ad07885887811260"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a709458f6856f7af5ef422d76304aa8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>R_FREE_NAMETREE</b>(ARG)</td></tr>
<tr class="separator:a0a709458f6856f7af5ef422d76304aa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abab3e4236015c7bb93ae99d5e4b7e9ae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>R_FREE_STREAM</b>(ARG)</td></tr>
<tr class="separator:abab3e4236015c7bb93ae99d5e4b7e9ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd1a091f3a7bd9b0a55f5c13728b8236"><td class="memItemLeft" align="right" valign="top"><a id="abd1a091f3a7bd9b0a55f5c13728b8236"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>R_SET</b>(VAR,  TYPE)&#160;&#160;&#160;	VAR = *((TYPE*)p); p = (unsigned char*)p + sizeof(TYPE);</td></tr>
<tr class="separator:abd1a091f3a7bd9b0a55f5c13728b8236"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a125cb83a56272d67140eaaf488a6b1de"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>R_COPY_B</b>(VAR,  SIZE,  CAST)</td></tr>
<tr class="separator:a125cb83a56272d67140eaaf488a6b1de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a048d47b002b544430e73096d7438759b"><td class="memItemLeft" align="right" valign="top"><a id="a048d47b002b544430e73096d7438759b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S_WRITE_B</b>(BUF,  LEN)&#160;&#160;&#160;	if ( fwrite_cached(BUF, 1, LEN, fd) != (size_t)(LEN) ) return(__LINE__);</td></tr>
<tr class="separator:a048d47b002b544430e73096d7438759b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9fa41e9d83a853b62f46a3ce1afba16"><td class="memItemLeft" align="right" valign="top"><a id="ac9fa41e9d83a853b62f46a3ce1afba16"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S_FLUSH_B</b>&#160;&#160;&#160;	if ( flush_cache(fd) != 1 ) return(__LINE__);</td></tr>
<tr class="separator:ac9fa41e9d83a853b62f46a3ce1afba16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ea833cf244d1c1fefdb878949c5ae5b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>R_COPY_S</b>(VAR,  CAST)</td></tr>
<tr class="separator:a7ea833cf244d1c1fefdb878949c5ae5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa194cbb0b10d0ff081badacbc637d7e2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>S_WRITE_S</b>(STR)</td></tr>
<tr class="separator:aa194cbb0b10d0ff081badacbc637d7e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a640a5982578c2c61c3bd97b206bd476a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>R_COPY_LIST</b>(ARG)</td></tr>
<tr class="separator:a640a5982578c2c61c3bd97b206bd476a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93a3e305b899d2db3c1be75c840c7d0d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>S_WRITE_LIST</b>(LST)</td></tr>
<tr class="separator:a93a3e305b899d2db3c1be75c840c7d0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a994234e3b7777517566c0ea4335417d3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>R_COPY_NAMETREE</b>(ARG)</td></tr>
<tr class="separator:a994234e3b7777517566c0ea4335417d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31526179ed05e2fed04ca7496b840e5b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>S_WRITE_NAMETREE</b>(ARG)</td></tr>
<tr class="separator:a31526179ed05e2fed04ca7496b840e5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd2a76c8a193eef25c9760e59cc6ee66"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>S_WRITE_DOLLAR</b>(ARG)</td></tr>
<tr class="separator:abd2a76c8a193eef25c9760e59cc6ee66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea91ff04a10bf50ed7fc5e0e2ba8f42d"><td class="memItemLeft" align="right" valign="top"><a id="aea91ff04a10bf50ed7fc5e0e2ba8f42d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ANNOUNCE</b>(str)</td></tr>
<tr class="separator:aea91ff04a10bf50ed7fc5e0e2ba8f42d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa721ba185dcbac9d5bcfc8ec83a3617e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="checkpoint_8c.html#aa721ba185dcbac9d5bcfc8ec83a3617e">CheckRecoveryFile</a> (VOID)</td></tr>
<tr class="separator:aa721ba185dcbac9d5bcfc8ec83a3617e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaabd0c1c468b9245ec386e7ed77889e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="checkpoint_8c.html#adaabd0c1c468b9245ec386e7ed77889e">DeleteRecoveryFile</a> (VOID)</td></tr>
<tr class="separator:adaabd0c1c468b9245ec386e7ed77889e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad87fb6c4005d12a499775b1d95fcf7db"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="checkpoint_8c.html#ad87fb6c4005d12a499775b1d95fcf7db">RecoveryFilename</a> (VOID)</td></tr>
<tr class="separator:ad87fb6c4005d12a499775b1d95fcf7db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e6c6dece865083e5cc91eff897fc2ab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="checkpoint_8c.html#a2e6c6dece865083e5cc91eff897fc2ab">InitRecovery</a> (VOID)</td></tr>
<tr class="separator:a2e6c6dece865083e5cc91eff897fc2ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c367e7a3c9c3630ec5df77d969775de"><td class="memItemLeft" align="right" valign="top"><a id="a8c367e7a3c9c3630ec5df77d969775de"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>fwrite_cached</b> (const void *ptr, size_t size, size_t nmemb, FILE *fd)</td></tr>
<tr class="separator:a8c367e7a3c9c3630ec5df77d969775de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c17fdd7403ca33182c23ad308fc92b4"><td class="memItemLeft" align="right" valign="top"><a id="a4c17fdd7403ca33182c23ad308fc92b4"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>flush_cache</b> (FILE *fd)</td></tr>
<tr class="separator:a4c17fdd7403ca33182c23ad308fc92b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9213bd2589bf698d8ee098f10bf12d65"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="checkpoint_8c.html#a9213bd2589bf698d8ee098f10bf12d65">DoRecovery</a> (int *moduletype)</td></tr>
<tr class="separator:a9213bd2589bf698d8ee098f10bf12d65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60d3513a65e83e59f4aa48421f7356e6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="checkpoint_8c.html#a60d3513a65e83e59f4aa48421f7356e6">DoCheckpoint</a> (int moduletype)</td></tr>
<tr class="separator:a60d3513a65e83e59f4aa48421f7356e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a71a669dc7a8d59ea0863f47f459d3e53"><td class="memItemLeft" align="right" valign="top"><a id="a71a669dc7a8d59ea0863f47f459d3e53"></a>
unsigned char&#160;</td><td class="memItemRight" valign="bottom"><b>cache_buffer</b> [CACHE_SIZE]</td></tr>
<tr class="separator:a71a669dc7a8d59ea0863f47f459d3e53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf4151d1fd5c7ef3594ac1e995de4480"><td class="memItemLeft" align="right" valign="top"><a id="aaf4151d1fd5c7ef3594ac1e995de4480"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>cache_fill</b> = 0</td></tr>
<tr class="separator:aaf4151d1fd5c7ef3594ac1e995de4480"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Contains all functions that deal with the recovery mechanism controlled and activated by the On Checkpoint switch.</p>
<p>The main function are DoCheckpoint, DoRecovery, and DoSnapshot. If the checkpoints are activated DoCheckpoint is called every time a module is finished executing. If the conditions for the creation of a recovery snapshot are met DoCheckpoint calls DoSnapshot. DoRecovery is called once when FORM starts up with the command line argument -R. Most of the other code contains debugging facilities that are only compiled if the macro PRINTDEBUG is defined.</p>
<p>The recovery mechanism is atomic, i.e. only if everything went well, the final recovery file is created (and the older one overwritten) in a single step (copying). If some errors occur, a warning is issued and the program continues without having created a new recovery file. The only situation in which the creation of the recovery data leads to a termination of the running program is if not enough disk or memory space is left.</p>
<p>For ParFORM each slave creates its own recovery file, sends it to the master and then it deletes the recovery file. The master stores all the recovery files and on recovery it feeds these files to the slaves. It is nearly impossible to recover after some MPI fault so ParFORM terminates on any recovery failure.</p>
<p>DoRecovery and DoSnapshot do the loading and saving of the recovery data, respectively. Every change in one functions needs to be accompanied by the appropriate change in the other function. The structure of both functions is quite similar. They handle the relevant global structs one after the other and then care about the copying of the hide and scratch files.</p>
<p>The names of the recovery, scratch and hide files are hard-coded in the variables in fold "filenames and system commands".</p>
<p>If the global structs AM,AP,AC,AR are changed, DoRecovery and DoSnapshot usually also have to be changed. Some structs are read/written as a whole (AP,AC), some are read/written only partly as a selection of their individual elements (AM,AR). If AM or AR have been changed by adding or removing an element that is important for the runtime status, then the reading/writing statements have to be added to or removed from DoRecovery and DoSnapshot. If AP or AC are changed, then for non-pointer variables (in the case of a struct it also means that none of its elements is a pointer) nothing has to be changed in the functions here. If pointers are involved, extra code has to be added (or removed). See the comments of DoRecovery and DoSnapshot. </p>

<p class="definition">Definition in file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a0a709458f6856f7af5ef422d76304aa8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a709458f6856f7af5ef422d76304aa8">&#9670;&nbsp;</a></span>R_FREE_NAMETREE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R_FREE_NAMETREE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ARG</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    R_FREE(ARG-&gt;namenode); \</div>
<div class="line">    R_FREE(ARG-&gt;namebuffer); \</div>
<div class="line">    R_FREE(ARG);</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01283">1283</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="abab3e4236015c7bb93ae99d5e4b7e9ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abab3e4236015c7bb93ae99d5e4b7e9ae">&#9670;&nbsp;</a></span>R_FREE_STREAM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R_FREE_STREAM</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ARG</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    R_FREE(ARG.buffer); \</div>
<div class="line">    R_FREE(ARG.FoldName); \</div>
<div class="line">    R_FREE(ARG.name);</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01288">1288</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="a125cb83a56272d67140eaaf488a6b1de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a125cb83a56272d67140eaaf488a6b1de">&#9670;&nbsp;</a></span>R_COPY_B</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R_COPY_B</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">VAR, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">SIZE, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">CAST&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    VAR = (CAST)Malloc1(SIZE,#VAR); \</div>
<div class="line">    memcpy(VAR, p, SIZE); p = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)p + SIZE;</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01300">1300</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="a7ea833cf244d1c1fefdb878949c5ae5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ea833cf244d1c1fefdb878949c5ae5b">&#9670;&nbsp;</a></span>R_COPY_S</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R_COPY_S</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">VAR, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">CAST&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">if</span> ( VAR ) { \</div>
<div class="line">        VAR = (CAST)Malloc1(strlen(p)+1,<span class="stringliteral">&quot;R_COPY_S&quot;</span>); \</div>
<div class="line">        strcpy((<span class="keywordtype">char</span>*)VAR, p); p = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)p + strlen(p) + 1; \</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01312">1312</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="aa194cbb0b10d0ff081badacbc637d7e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa194cbb0b10d0ff081badacbc637d7e2">&#9670;&nbsp;</a></span>S_WRITE_S</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define S_WRITE_S</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">STR</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">if</span> ( STR ) { \</div>
<div class="line">        l = strlen((<span class="keywordtype">char</span>*)STR) + 1; \</div>
<div class="line">        if ( fwrite_cached(STR, 1, l, fd) != (<span class="keywordtype">size_t</span>)l ) <span class="keywordflow">return</span>(__LINE__); \</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01318">1318</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="a640a5982578c2c61c3bd97b206bd476a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a640a5982578c2c61c3bd97b206bd476a">&#9670;&nbsp;</a></span>R_COPY_LIST</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R_COPY_LIST</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ARG</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">if</span> ( ARG.maxnum ) { \</div>
<div class="line">        R_COPY_B(ARG.lijst, ARG.size*ARG.maxnum, <span class="keywordtype">void</span>*) \</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01326">1326</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="a93a3e305b899d2db3c1be75c840c7d0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93a3e305b899d2db3c1be75c840c7d0d">&#9670;&nbsp;</a></span>S_WRITE_LIST</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define S_WRITE_LIST</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">LST</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">if</span> ( LST.maxnum ) { \</div>
<div class="line">        S_WRITE_B((<span class="keywordtype">char</span>*)LST.lijst, LST.maxnum*LST.size) \</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01331">1331</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="a994234e3b7777517566c0ea4335417d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a994234e3b7777517566c0ea4335417d3">&#9670;&nbsp;</a></span>R_COPY_NAMETREE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R_COPY_NAMETREE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ARG</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    R_COPY_B(ARG, <span class="keyword">sizeof</span>(<a class="code" href="structNaMeTree.html">NAMETREE</a>), <a class="code" href="structNaMeTree.html">NAMETREE</a>*); \</div>
<div class="line">    if ( ARG-&gt;namenode ) { \</div>
<div class="line">        R_COPY_B(ARG-&gt;namenode, ARG-&gt;nodesize*<span class="keyword">sizeof</span>(<a class="code" href="structNaMeNode.html">NAMENODE</a>), <a class="code" href="structNaMeNode.html">NAMENODE</a>*); \</div>
<div class="line">    } \</div>
<div class="line">    if ( ARG-&gt;namebuffer ) { \</div>
<div class="line">        R_COPY_B(ARG-&gt;namebuffer, ARG-&gt;namesize, UBYTE*); \</div>
<div class="line">    }</div>
<div class="ttc" id="astructNaMeNode_html"><div class="ttname"><a href="structNaMeNode.html">NaMeNode</a></div><div class="ttdef"><b>Definition:</b> <a href="structs_8h_source.html#l00247">structs.h:247</a></div></div>
<div class="ttc" id="astructNaMeTree_html"><div class="ttname"><a href="structNaMeTree.html">NaMeTree</a></div><div class="ttdef"><b>Definition:</b> <a href="structs_8h_source.html#l00265">structs.h:265</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01338">1338</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="a31526179ed05e2fed04ca7496b840e5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31526179ed05e2fed04ca7496b840e5b">&#9670;&nbsp;</a></span>S_WRITE_NAMETREE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define S_WRITE_NAMETREE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ARG</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    S_WRITE_B(ARG, <span class="keyword">sizeof</span>(<a class="code" href="structNaMeTree.html">NAMETREE</a>)); \</div>
<div class="line">    if ( ARG-&gt;namenode ) { \</div>
<div class="line">        S_WRITE_B(ARG-&gt;namenode, ARG-&gt;nodesize*<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNaMeNode.html">NaMeNode</a>)); \</div>
<div class="line">    } \</div>
<div class="line">    if ( ARG-&gt;namebuffer ) { \</div>
<div class="line">        S_WRITE_B(ARG-&gt;namebuffer, ARG-&gt;namesize); \</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01347">1347</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="abd2a76c8a193eef25c9760e59cc6ee66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd2a76c8a193eef25c9760e59cc6ee66">&#9670;&nbsp;</a></span>S_WRITE_DOLLAR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define S_WRITE_DOLLAR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ARG</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">if</span> ( ARG.size &amp;&amp; ARG.where &amp;&amp; ARG.where != &amp;(AM.dollarzero) ) { \</div>
<div class="line">        S_WRITE_B(ARG.where, ARG.size*<span class="keyword">sizeof</span>(WORD)) \</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01358">1358</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aa721ba185dcbac9d5bcfc8ec83a3617e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa721ba185dcbac9d5bcfc8ec83a3617e">&#9670;&nbsp;</a></span>CheckRecoveryFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CheckRecoveryFile </td>
          <td>(</td>
          <td class="paramtype">VOID&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Checks whether a snapshot/recovery file exists. Returns 1 if it exists, 0 otherwise. </p>

<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l00278">278</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="adaabd0c1c468b9245ec386e7ed77889e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaabd0c1c468b9245ec386e7ed77889e">&#9670;&nbsp;</a></span>DeleteRecoveryFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DeleteRecoveryFile </td>
          <td>(</td>
          <td class="paramtype">VOID&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Deletes the recovery files. It is called by CleanUp() in the case of a successful completion. </p>

<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l00333">333</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="ad87fb6c4005d12a499775b1d95fcf7db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad87fb6c4005d12a499775b1d95fcf7db">&#9670;&nbsp;</a></span>RecoveryFilename()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* RecoveryFilename </td>
          <td>(</td>
          <td class="paramtype">VOID&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns pointer to recovery filename. </p>

<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l00364">364</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="a2e6c6dece865083e5cc91eff897fc2ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e6c6dece865083e5cc91eff897fc2ab">&#9670;&nbsp;</a></span>InitRecovery()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InitRecovery </td>
          <td>(</td>
          <td class="paramtype">VOID&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets up the strings for the filenames of the recovery files. This functions should only be called once to avoid memory leaks and after AM.TempDir has been initialized. </p>

<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l00399">399</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="a9213bd2589bf698d8ee098f10bf12d65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9213bd2589bf698d8ee098f10bf12d65">&#9670;&nbsp;</a></span>DoRecovery()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DoRecovery </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>moduletype</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reads from the recovery file and restores all necessary variables and states in FORM, so that the execution can recommence in preprocessor() as if no restart of FORM had occurred.</p>
<p>The recovery file is read into memory as a whole. The pointer p then points into this memory at the next non-processed data. The macros by which variables are restored, like R_SET, automatically increase p appropriately.</p>
<p>If something goes wrong, the function returns with a non-zero value.</p>
<p>Allocated memory that would be lost when overwriting the global structs with data from the file is freed first. A major part of the code deals with the restoration of pointers. The idiom we use is to memorize the original pointer value (org), allocate new memory and copy the data from the file into this memory, calculate the offset between the old pointer value and the new allocated memory position (ofs), and then correct all affected pointers (+=ofs).</p>
<p>We rely on the fact that several variables (especially in AM) are already assigned the correct values by the startup functions. That means, in principle, that a change in the setup files between snapshot creation and recovery will be noticed. </p>

<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l01401">1401</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

</div>
</div>
<a id="a60d3513a65e83e59f4aa48421f7356e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60d3513a65e83e59f4aa48421f7356e6">&#9670;&nbsp;</a></span>DoCheckpoint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DoCheckpoint </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>moduletype</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Checks whether a snapshot should be done. Calls DoSnapshot() to create the snapshot. </p>

<p class="definition">Definition at line <a class="el" href="checkpoint_8c_source.html#l03108">3108</a> of file <a class="el" href="checkpoint_8c_source.html">checkpoint.c</a>.</p>

<p class="reference">References <a class="el" href="tools_8c_source.html#l03476">TimeWallClock()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
